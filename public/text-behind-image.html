<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CVLWHYTTPL"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CVLWHYTTPL');
    </script>

    <title>Text Behind Image Generator - Free 3D Text Effects with AI Background Removal | Magic Mockup</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/images/icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/icon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#a090c1">
    <meta name="msapplication-TileColor" content="#a090c1">
    <meta name="theme-color" content="#a090c1">
    
    <!-- Enhanced SEO Meta Tags -->
    <meta name="description" content="Create stunning text-behind-image designs with AI-powered background removal. Free 3D text effects tool that positions text behind subjects in your photos. Perfect for social media, marketing, and creative designs.">
    <meta name="keywords" content="text behind image, 3D text effects, background removal, AI design tool, photo editing, text effects, social media design, Instagram text effects, TikTok text behind image, free text editor, 3D typography, text overlay, creative text effects, AI photo editor, background remover">
    <meta name="author" content="Magic Mockup">
    <meta name="robots" content="index, follow">
    <meta name="application-name" content="Text Behind Image - Magic Mockup">
    <meta name="apple-mobile-web-app-title" content="Text Behind Image">
    <link rel="canonical" href="https://magicmockup.xyz/text-behind-image.html">
    
    <!-- Open Graph / Facebook / Threads -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://magicmockup.xyz/text-behind-image.html">
    <meta property="og:title" content="Text Behind Image Generator - Free 3D Text Effects with AI Background Removal">
    <meta property="og:description" content="Create stunning text-behind-image designs with AI-powered background removal. Free 3D text effects tool that positions text behind subjects in your photos. Perfect for social media, marketing, and creative designs.">
    <meta property="og:image" content="https://magicmockup.xyz/images/textbehindimagehome.png">
    <meta property="og:image:secure_url" content="https://magicmockup.xyz/images/textbehindimagehome.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Text Behind Image tool interface showing 3D text effects with AI background removal">
    <meta property="og:site_name" content="Magic Mockup">
    <meta property="og:locale" content="en_US">
    
    <!-- Additional meta tags for better social media compatibility -->
    <meta property="article:author" content="Magic Mockup">
    <meta name="format-detection" content="telephone=no">
    <meta name="HandheldFriendly" content="true">
    
    <!-- Threads/Instagram specific -->
    <meta property="instagram:card" content="summary_large_image">
    <meta property="instagram:site" content="@magicmockup">
    <meta property="instagram:title" content="Text Behind Image Generator - Free 3D Text Effects with AI Background Removal">
    <meta property="instagram:description" content="Create stunning text-behind-image designs with AI-powered background removal. Free 3D text effects tool that positions text behind subjects in your photos.">
    <meta property="instagram:image" content="https://magicmockup.xyz/images/textbehindimagehome.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@magicmockup">
    <meta name="twitter:creator" content="@magicmockup">
    <meta name="twitter:url" content="https://magicmockup.xyz/text-behind-image.html">
    <meta name="twitter:title" content="Text Behind Image Generator - Free 3D Text Effects with AI Background Removal">
    <meta name="twitter:description" content="Create stunning text-behind-image designs with AI-powered background removal. Free 3D text effects tool that positions text behind subjects in your photos.">
    <meta name="twitter:image" content="https://magicmockup.xyz/images/textbehindimagehome.png">
    <meta name="twitter:image:alt" content="Text Behind Image tool interface showing 3D text effects with AI background removal">
    
    <!-- LinkedIn -->
    <meta property="linkedin:owner" content="Magic Mockup">
    
    <!-- Pinterest -->
    <meta name="pinterest" content="nopin" description="This site does not allow pinning">
    
    <!-- WhatsApp/Telegram -->
    <meta property="whatsapp:image" content="https://magicmockup.xyz/images/textbehindimagehome.png">
    
    <!-- Additional social media tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Text Behind Image Generator",
      "alternateName": "Magic Mockup Text Behind Image Tool",
      "url": "https://magicmockup.xyz/text-behind-image.html",
      "description": "Create stunning text-behind-image designs with AI-powered background removal. Free 3D text effects tool that positions text behind subjects in your photos. Perfect for social media, marketing, and creative designs.",
      "applicationCategory": "DesignApplication",
      "operatingSystem": "Web Browser",
      "browserRequirements": "Requires JavaScript. Works on Chrome, Firefox, Safari, Edge.",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "creator": {
        "@type": "Organization",
        "name": "Magic Mockup",
        "url": "https://magicmockup.xyz/"
      },
      "featureList": [
        "AI-powered background removal",
        "3D text positioning and effects",
        "Custom fonts and styling",
        "Text rotation and tilt effects",
        "Opacity and color controls",
        "Letter spacing adjustment",
        "Instant preview",
        "High-quality PNG export",
        "Mobile-friendly interface",
        "No registration required",
        "Free to use"
      ],
      "screenshot": "https://magicmockup.xyz/images/textbehindimagehome.png",
      "softwareVersion": "2.0",
      "dateModified": "2024-12-19",
      "inLanguage": "en-US",
      "isAccessibleForFree": true,
      "mainEntity": {
        "@type": "SoftwareApplication",
        "name": "Text Behind Image Effect Generator",
        "description": "AI-powered tool for creating 3D text effects that appear behind image subjects",
        "applicationCategory": "MultimediaApplication",
        "downloadUrl": "https://magicmockup.xyz/text-behind-image.html",
        "softwareHelp": {
          "@type": "CreativeWork",
          "name": "How to create text behind image effects",
          "description": "Upload an image, add text, customize styling, and download your creation"
        }
      },
      "potentialAction": {
        "@type": "UseAction",
        "name": "Create Text Behind Image Design",
        "description": "Upload your photo and create stunning text-behind-image effects",
        "target": "https://magicmockup.xyz/text-behind-image.html"
      },
      "audience": {
        "@type": "Audience",
        "audienceType": "Designers, Social Media Creators, Marketers, Content Creators"
      }
    }
    </script>

    <!-- Fathom Analytics -->
    <script src="https://cdn.usefathom.com/script.js" data-spa="auto" data-site="TJAMQVTD" defer></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.5rem;
            color: #0f172a;
        }

        .back-btn {
            background: #f1f5f9;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            color: #64748b;
            margin-right: 1rem;
        }

        .back-btn:hover {
            background: #e2e8f0;
        }

        .save-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 1rem;
        }

        .save-btn:hover {
            background: #059669;
        }

        .main-content {
            min-height: calc(100vh - 80px);
            margin-right: 350px; /* Make room for fixed sidebar */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .canvas-area {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .image-container {
            position: relative;
            max-width: 100%;
            max-height: 70vh;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .background-image, .foreground-image {
            display: block;
            max-width: 100%;
            max-height: 70vh;
            object-fit: contain;
        }

        .foreground-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
        }

        .text-overlay {
            position: absolute;
            text-align: center;
            white-space: nowrap;
            z-index: 5;
            transform-style: preserve-3d;
        }

        .controls-area {
            width: 350px;
            background: white;
            border-left: 1px solid #e2e8f0;
            padding: 1.5rem;
            position: fixed;
            right: 0;
            top: 80px;
            height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .upload-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            padding: 2rem;
            gap: 2rem;
        }

        .dropzone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
            height: 400px;
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dropzone:hover, .dropzone.dragover {
            border-color: #4f46e5;
            background: #fafbff;
        }

        .control-group {
            margin-bottom: 1rem;
        }

        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
        }

        .control-group input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 0.25rem;
        }

        .control-group input[type="color"] {
            width: 100%;
            height: 40px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
        }

        .control-group span {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .add-text-btn {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .processing-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .processing-content {
            text-align: center;
        }

        .processing-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .header {
                padding: 0.75rem 1rem;
                flex-direction: column;
                gap: 0.75rem;
                align-items: stretch;
            }

            .header h1 {
                font-size: 1.25rem;
                text-align: center;
            }

            .header > div:first-child {
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .header > div:last-child {
                display: flex;
                gap: 0.5rem;
                justify-content: center;
            }

            .save-btn {
                padding: 0.625rem 1rem;
                font-size: 0.875rem;
            }

            .back-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
                margin-right: 0;
            }

            .main-content {
                margin-right: 0;
                flex-direction: column;
                min-height: calc(100vh - 120px);
                position: relative;
            }

            .canvas-area {
                position: fixed;
                top: 120px;
                left: 0;
                right: 0;
                z-index: 10;
                background: #f8fafc;
                border-bottom: 2px solid #e2e8f0;
                padding: 0.5rem;
                height: 50vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .image-container {
                max-height: 45vh;
                max-width: 95vw;
            }

            .background-image, .foreground-image {
                max-height: 45vh;
                max-width: 95vw;
            }

            .controls-area {
                position: fixed;
                top: calc(50vh + 120px);
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                border-left: none;
                border-top: none;
                overflow-y: auto;
                padding: 1rem;
                padding-bottom: 2rem;
                background: white;
                z-index: 5;
                -webkit-overflow-scrolling: touch;
            }

            .upload-area {
                position: fixed;
                top: 120px;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 10;
                background: #f8fafc;
                overflow-y: auto;
            }

            .dropzone {
                height: 250px;
                margin: 1rem;
            }

            .control-group {
                margin-bottom: 1.5rem;
                padding: 0.5rem 0;
            }

            .control-group label {
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
                display: block;
                padding: 0.25rem 0;
            }

            .control-group input[type="text"] {
                padding: 0.625rem;
                font-size: 0.875rem;
                margin: 0.5rem 0;
            }

            .control-group input[type="range"] {
                height: 44px;
                margin: 0.75rem 0;
                padding: 0.5rem 0;
            }

            .control-group input[type="color"] {
                height: 44px;
                margin: 0.5rem 0;
            }

            /* Create larger touch targets for sliders */
            .control-group input[type="range"] {
                position: relative;
                background: transparent;
            }

            /* Add padding around sliders to prevent accidental scrolling */
            .control-group input[type="range"]:before {
                content: '';
                position: absolute;
                top: -10px;
                bottom: -10px;
                left: -10px;
                right: -10px;
                z-index: -1;
            }

            .add-text-btn {
                width: 100%;
                padding: 0.75rem;
                margin-bottom: 1.5rem;
            }

            /* Add scroll areas between controls */
            .controls-area h3, .controls-area h4 {
                padding: 1rem 0 0.5rem 0;
                margin: 1rem 0 0.5rem 0;
                border-top: 1px solid #f1f5f9;
            }

            .controls-area h3:first-child {
                border-top: none;
                margin-top: 0;
                padding-top: 0;
            }

            /* Highly visible sliders for mobile */
            .control-group input[type="range"] {
                -webkit-appearance: none;
                height: 50px;
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                border: 2px solid #4f46e5;
                border-radius: 25px;
                margin: 0.75rem 0;
                padding: 8px;
                box-shadow: 0 2px 8px rgba(79, 70, 229, 0.2);
                position: relative;
            }

            .control-group input[type="range"]::-webkit-slider-track {
                height: 12px;
                background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
                border-radius: 6px;
                border: 1px solid #3730a3;
            }

            .control-group input[type="range"]::-webkit-slider-thumb {
                -webkit-appearance: none;
                height: 32px;
                width: 32px;
                border-radius: 50%;
                background: radial-gradient(circle, #ffffff 0%, #f8fafc 50%, #e2e8f0 100%);
                border: 3px solid #4f46e5;
                cursor: pointer;
                margin-top: -13px;
                box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
            }

            .control-group input[type="range"]::-moz-range-track {
                height: 12px;
                background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
                border-radius: 6px;
                border: 1px solid #3730a3;
            }

            .control-group input[type="range"]::-moz-range-thumb {
                height: 32px;
                width: 32px;
                border-radius: 50%;
                background: radial-gradient(circle, #ffffff 0%, #f8fafc 50%, #e2e8f0 100%);
                border: 3px solid #4f46e5;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
            }


            /* Container for sliders with visual boundaries */
            .control-group.slider-zone {
                background: linear-gradient(135deg, #fef7ff 0%, #f3f4f6 100%);
                border: 2px dashed #4f46e5;
                border-radius: 12px;
                padding: 1rem;
                margin: 1rem 0;
                position: relative;
                box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);
            }


            /* Improve touch targets for mobile */
            .canvas-area {
                touch-action: manipulation;
            }

            /* Better spacing between controls on mobile */
            .control-group input, .control-group button {
                min-height: 44px;
            }

            /* Prevent unwanted focus on mobile - but allow buttons */
            .controls-area {
                -webkit-tap-highlight-color: transparent;
                -webkit-touch-callout: none;
            }

            /* Prevent selection on non-interactive elements */
            .controls-area h3, .controls-area h4, .controls-area label, .controls-area span {
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }

            /* Allow selection only for text inputs */
            .control-group input[type="text"] {
                -webkit-user-select: text;
                -moz-user-select: text;
                -ms-user-select: text;
                user-select: text;
            }

            /* Ensure buttons are interactive */
            .add-text-btn, button {
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                touch-action: manipulation;
            }

            /* Safe scroll zones between slider groups */
            .control-group.safe-zone {
                background: #f8fafc;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                padding: 0.75rem;
                margin: 0.5rem 0;
            }

            .control-group.safe-zone::before {
                content: '✅ SAFE SCROLL AREA';
                position: absolute;
                top: -10px;
                right: 8px;
                background: #10b981;
                color: white;
                padding: 2px 8px;
                border-radius: 8px;
                font-size: 9px;
                font-weight: bold;
            }

            /* Add extra spacing and visual cues */
            .control-group.slider-zone {
                margin: 2rem 0;
                animation: pulseWarning 3s infinite;
            }

            @keyframes pulseWarning {
                0%, 100% { 
                    border-color: #4f46e5; 
                    box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);
                }
                50% { 
                    border-color: #ef4444; 
                    box-shadow: 0 2px 12px rgba(239, 68, 68, 0.2);
                }
            }

            .control-group.safe-zone {
                margin: 1rem 0;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0.5rem;
            }

            .canvas-area {
                padding: 0.25rem;
                height: 45vh;
            }

            .controls-area {
                padding: 0.75rem;
                top: calc(45vh + 120px);
            }

            .image-container {
                max-height: 40vh;
                max-width: 98vw;
            }

            .background-image, .foreground-image {
                max-height: 40vh;
                max-width: 98vw;
            }

            .upload-area {
                top: 110px;
            }

            .dropzone {
                height: 200px;
                margin: 0.5rem;
            }

            .dropzone h2 {
                font-size: 1.25rem;
            }

            .dropzone p {
                font-size: 0.875rem;
            }

            .control-group {
                margin-bottom: 1rem;
            }

            .control-group input[type="text"] {
                font-size: 16px; /* Prevent zoom on iOS */
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div>
            <a href="/" class="back-btn" rel="home">← Back to Home</a>
            <h1 style="font-size: 1.5rem; font-weight: 600; margin: 0;">Text Behind Image Generator</h1>
        </div>
        <div>
            <input type="file" id="fileInput" accept="image/*" style="display: none;" aria-label="Upload image file">
            <button class="save-btn hidden" id="saveBtn" onclick="saveCompositeImage()" aria-label="Save your text behind image design">💾 Save Image</button>
        </div>
    </header>

    <!-- Fixed Right Sidebar -->
    <div class="controls-area">
        <h3 style="margin-bottom: 1rem;">Text Layers</h3>
        <button class="add-text-btn" onclick="addNewTextSet()">➕ Add Text</button>
        
        <div id="textSets" style="margin-bottom: 1rem;">
            <!-- Text sets will be added here -->
        </div>

        <div id="textControls" class="hidden">
            <h4 style="margin-bottom: 1rem;">Edit Text</h4>
            
            <div class="control-group">
                <label>Text</label>
                <input type="text" id="textInput" value="edit" oninput="updateText()">
            </div>

            <div class="control-group">
                <label>Font Size</label>
                <input type="range" id="fontSizeSlider" min="20" max="400" value="200" onchange="updateFontSize()">
                <span id="fontSizeValue">200px</span>
            </div>

            <div class="control-group">
                <label>Color</label>
                <input type="color" id="colorPicker" value="#ffffff" onchange="updateColor()">
            </div>

            <div class="control-group">
                <label>Position X</label>
                <input type="range" id="posXSlider" min="-50" max="50" value="0" onchange="updatePosition()">
            </div>

            <div class="control-group">
                <label>Position Y</label>
                <input type="range" id="posYSlider" min="-50" max="50" value="0" onchange="updatePosition()">
            </div>

            <div class="control-group">
                <label>Rotation</label>
                <input type="range" id="rotationSlider" min="-180" max="180" value="0" onchange="updateRotation()">
                <span id="rotationValue">0°</span>
            </div>

            <div class="control-group">
                <label>Tilt X</label>
                <input type="range" id="tiltXSlider" min="-60" max="60" value="0" onchange="updateTilt()">
                <span id="tiltXValue">0°</span>
            </div>

            <div class="control-group">
                <label>Tilt Y</label>
                <input type="range" id="tiltYSlider" min="-60" max="60" value="0" onchange="updateTilt()">
                <span id="tiltYValue">0°</span>
            </div>

            <div class="control-group">
                <label>Opacity</label>
                <input type="range" id="opacitySlider" min="0" max="1" step="0.1" value="1" onchange="updateOpacity()">
            </div>

            <div class="control-group">
                <label>Letter Spacing</label>
                <input type="range" id="letterSpacingSlider" min="0" max="50" value="0" onchange="updateLetterSpacing()">
                <span id="letterSpacingValue">0px</span>
            </div>
        </div>
    </div>

    <div class="main-content">
        <main id="uploadArea" class="upload-area">
            <section class="dropzone" id="dropzone" role="button" tabindex="0" aria-label="Upload image area">
                <div style="font-size: 3rem; color: #9ca3af; margin-bottom: 1rem;" aria-hidden="true">📷</div>
                <h2 style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: 600; color: #374151;">Upload an Image to Create Text Behind Image Effects</h2>
                <p style="margin: 0; color: #6b7280;">Drag & drop an image here, or click to select</p>
                <small style="color: #9ca3af; font-size: 0.875rem; margin-top: 0.5rem;">For best results, use images with clear subjects against contrasting backgrounds. AI background removal works best with people, objects, and animals.</small>
            </section>
            
            <!-- SEO Content Section (hidden when app is active) -->
            <section class="seo-content" style="max-width: 800px; margin: 2rem auto; padding: 0 1rem; text-align: left; color: #374151; line-height: 1.6;">
                <h2 style="font-size: 1.75rem; font-weight: 700; margin: 2rem 0 1rem 0; color: #111827;">Free Text Behind Image Generator with AI Background Removal</h2>
                <p style="margin-bottom: 1.5rem;">Create stunning <strong>text behind image effects</strong> with our free AI-powered tool. Perfect for social media posts, marketing materials, and creative designs. Our advanced background removal technology automatically separates your subject from the background, allowing you to position text behind them for professional-looking results.</p>
                
                <h3 style="font-size: 1.5rem; font-weight: 600; margin: 2rem 0 1rem 0; color: #1f2937;">Key Features:</h3>
                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                    <li style="margin-bottom: 0.5rem;"><strong>AI Background Removal:</strong> Automatically remove backgrounds with precision</li>
                    <li style="margin-bottom: 0.5rem;"><strong>3D Text Effects:</strong> Add depth with rotation, tilt, and perspective controls</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Custom Styling:</strong> Choose colors, fonts, sizes, and spacing</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Real-time Preview:</strong> See your changes instantly as you edit</li>
                    <li style="margin-bottom: 0.5rem;"><strong>High-Quality Export:</strong> Download in PNG format for best quality</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Mobile Friendly:</strong> Works perfectly on phones and tablets</li>
                </ul>
                
                <h3 style="font-size: 1.5rem; font-weight: 600; margin: 2rem 0 1rem 0; color: #1f2937;">Perfect for:</h3>
                <ul style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                    <li style="margin-bottom: 0.5rem;">Instagram and TikTok posts</li>
                    <li style="margin-bottom: 0.5rem;">Facebook and Twitter content</li>
                    <li style="margin-bottom: 0.5rem;">Marketing campaigns and advertisements</li>
                    <li style="margin-bottom: 0.5rem;">Product launches and announcements</li>
                    <li style="margin-bottom: 0.5rem;">Personal branding and portfolio work</li>
                    <li style="margin-bottom: 0.5rem;">Creative art and design projects</li>
                </ul>
                
                <p style="margin-bottom: 1.5rem;">No registration required, completely free to use, and works directly in your browser. Start creating professional text behind image effects in seconds!</p>
            </section>
        </main>

        <div id="workArea" class="hidden">
            <div class="canvas-area">
                <div class="image-container" id="imageContainer">
                    <div id="processingOverlay" class="processing-overlay hidden">
                        <div class="processing-content">
                            <div class="processing-spinner"></div>
                            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.25rem; font-weight: 600;">AI Processing</h3>
                            <p style="margin: 0; opacity: 0.8; font-size: 0.875rem;">Removing background with AI...</p>
                        </div>
                    </div>
                    <img id="backgroundImage" class="background-image hidden" />
                    <div id="textLayers"></div>
                    <img id="foregroundImage" class="foreground-image hidden" />
                </div>
            </div>
        </div>
    </div>

    <canvas id="downloadCanvas" style="display: none;"></canvas>

    <script type="module">
        import { removeBackground } from 'https://cdn.skypack.dev/@imgly/background-removal';
        
        let selectedImage = null;
        let removedBgImageUrl = null;
        let textSets = [];
        let currentTextId = 0;
        let isImageSetupDone = false;
        let previewMode = false;

        // File input handling
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const imageUrl = URL.createObjectURL(file);
                setSelectedImage(imageUrl);
            }
        });

        // Drag and drop
        const dropzone = document.getElementById('dropzone');
        dropzone.addEventListener('dragover', function(e) {
            e.preventDefault();
            dropzone.classList.add('dragover');
        });

        dropzone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            dropzone.classList.remove('dragover');
        });

        dropzone.addEventListener('drop', function(e) {
            e.preventDefault();
            dropzone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const imageUrl = URL.createObjectURL(files[0]);
                setSelectedImage(imageUrl);
            }
        });

        dropzone.addEventListener('click', function() {
            document.getElementById('fileInput').click();
        });

        async function setSelectedImage(imageUrl) {
            selectedImage = imageUrl;
            document.getElementById('uploadArea').classList.add('hidden');
            document.getElementById('workArea').classList.remove('hidden');
            document.getElementById('saveBtn').classList.remove('hidden');
            
            // Hide SEO content when app becomes active
            const seoContent = document.querySelector('.seo-content');
            if (seoContent) {
                seoContent.style.display = 'none';
            }
            
            const bgImage = document.getElementById('backgroundImage');
            bgImage.src = imageUrl;
            bgImage.classList.remove('hidden');

            await setupImage(imageUrl);
        }

        async function setupImage(imageUrl) {
            document.getElementById('processingOverlay').classList.remove('hidden');
            
            try {
                const imageBlob = await removeBackground(imageUrl);
                const url = URL.createObjectURL(imageBlob);
                removedBgImageUrl = url;
                
                const fgImage = document.getElementById('foregroundImage');
                fgImage.src = url;
                fgImage.classList.remove('hidden');
                
                isImageSetupDone = true;
                document.getElementById('processingOverlay').classList.add('hidden');
            } catch (error) {
                console.error('Background removal failed:', error);
                document.getElementById('processingOverlay').classList.add('hidden');
                isImageSetupDone = true;
            }
        }

        // Check if device is mobile
        function isMobile() {
            return window.innerWidth <= 768;
        }

        function addNewTextSet() {
            // Clear all existing text first (only allow one text at a time)
            clearAllText();
            
            currentTextId++;
            // Use smaller font size for mobile devices
            const defaultFontSize = isMobile() ? 80 : 200;
            
            const textSet = {
                id: currentTextId,
                text: 'edit',
                fontFamily: 'Inter',
                top: 0,
                left: 0,
                color: '#ffffff',
                fontSize: defaultFontSize,
                fontWeight: 800,
                opacity: 1,
                rotation: 0,
                tiltX: 0,
                tiltY: 0,
                letterSpacing: 0
            };
            
            textSets.push(textSet);
            createTextElement(textSet);
            updateControls(textSet);
            document.getElementById('textControls').classList.remove('hidden');
            
            // Setup mobile scroll protection for new sliders
            if (isMobile()) {
                setupSliderScrollProtection();
                addVisualZoneClasses();
            }
        }

        function clearAllText() {
            // Remove all existing text elements from DOM
            textSets.forEach(textSet => {
                const element = document.getElementById(`text-${textSet.id}`);
                if (element) {
                    element.remove();
                }
            });
            // Clear the textSets array
            textSets = [];
        }
        

        function createTextElement(textSet) {
            const textElement = document.createElement('div');
            textElement.className = 'text-overlay';
            textElement.id = `text-${textSet.id}`;
            textElement.textContent = textSet.text;
            updateTextStyle(textElement, textSet);
            
            document.getElementById('textLayers').appendChild(textElement);
        }

        function updateTextStyle(element, textSet) {
            element.style.cssText = `
                position: absolute;
                top: ${50 - textSet.top}%;
                left: ${textSet.left + 50}%;
                transform: translate(-50%, -50%) 
                          rotate(${textSet.rotation}deg)
                          perspective(1000px)
                          rotateX(${textSet.tiltX}deg)
                          rotateY(${textSet.tiltY}deg);
                color: ${textSet.color};
                text-align: center;
                font-size: ${textSet.fontSize}px;
                font-weight: ${textSet.fontWeight};
                font-family: ${textSet.fontFamily};
                opacity: ${textSet.opacity};
                letter-spacing: ${textSet.letterSpacing}px;
                transform-style: preserve-3d;
                z-index: 5;
            `;
        }
        
        function togglePreviewMode() {
            previewMode = document.getElementById('previewMode').checked;
            
            // Update all existing text elements
            textSets.forEach(textSet => {
                const element = document.getElementById(`text-${textSet.id}`);
                if (element) {
                    updateTextStyle(element, textSet);
                }
            });
        }

        function updateControls(textSet) {
            document.getElementById('textInput').value = textSet.text;
            document.getElementById('fontSizeSlider').value = textSet.fontSize;
            document.getElementById('fontSizeValue').textContent = textSet.fontSize + 'px';
            document.getElementById('colorPicker').value = textSet.color;
            document.getElementById('posXSlider').value = textSet.left;
            document.getElementById('posYSlider').value = textSet.top;
            document.getElementById('rotationSlider').value = textSet.rotation;
            document.getElementById('rotationValue').textContent = textSet.rotation + '°';
            document.getElementById('tiltXSlider').value = textSet.tiltX;
            document.getElementById('tiltXValue').textContent = textSet.tiltX + '°';
            document.getElementById('tiltYSlider').value = textSet.tiltY;
            document.getElementById('tiltYValue').textContent = textSet.tiltY + '°';
            document.getElementById('opacitySlider').value = textSet.opacity;
            document.getElementById('letterSpacingSlider').value = textSet.letterSpacing;
            document.getElementById('letterSpacingValue').textContent = textSet.letterSpacing + 'px';
            
            // Adjust font size slider max value for mobile
            const fontSizeSlider = document.getElementById('fontSizeSlider');
            if (isMobile()) {
                fontSizeSlider.max = 200;
            } else {
                fontSizeSlider.max = 400;
            }
        }

        function getCurrentTextSet() {
            return textSets[textSets.length - 1];
        }

        function updateText() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.text = document.getElementById('textInput').value;
            const element = document.getElementById(`text-${textSet.id}`);
            element.textContent = textSet.text;
        }

        function updateFontSize() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.fontSize = parseInt(document.getElementById('fontSizeSlider').value);
            document.getElementById('fontSizeValue').textContent = textSet.fontSize + 'px';
            updateTextStyle(document.getElementById(`text-${textSet.id}`), textSet);
        }

        function updateColor() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.color = document.getElementById('colorPicker').value;
            updateTextStyle(document.getElementById(`text-${textSet.id}`), textSet);
        }

        function updatePosition() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.left = parseInt(document.getElementById('posXSlider').value);
            textSet.top = parseInt(document.getElementById('posYSlider').value);
            updateTextStyle(document.getElementById(`text-${textSet.id}`), textSet);
        }

        function updateRotation() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.rotation = parseInt(document.getElementById('rotationSlider').value);
            document.getElementById('rotationValue').textContent = textSet.rotation + '°';
            updateTextStyle(document.getElementById(`text-${textSet.id}`), textSet);
        }

        function updateTilt() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.tiltX = parseInt(document.getElementById('tiltXSlider').value);
            textSet.tiltY = parseInt(document.getElementById('tiltYSlider').value);
            document.getElementById('tiltXValue').textContent = textSet.tiltX + '°';
            document.getElementById('tiltYValue').textContent = textSet.tiltY + '°';
            updateTextStyle(document.getElementById(`text-${textSet.id}`), textSet);
        }

        function updateOpacity() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.opacity = parseFloat(document.getElementById('opacitySlider').value);
            updateTextStyle(document.getElementById(`text-${textSet.id}`), textSet);
        }

        function updateLetterSpacing() {
            const textSet = getCurrentTextSet();
            if (!textSet) return;
            
            textSet.letterSpacing = parseInt(document.getElementById('letterSpacingSlider').value);
            document.getElementById('letterSpacingValue').textContent = textSet.letterSpacing + 'px';
            updateTextStyle(document.getElementById(`text-${textSet.id}`), textSet);
        }

        function saveCompositeImage() {
            if (!isImageSetupDone) return;

            const canvas = document.getElementById('downloadCanvas');
            const ctx = canvas.getContext('2d');

            const bgImg = new Image();
            bgImg.crossOrigin = "anonymous";
            bgImg.onload = () => {
                canvas.width = bgImg.width;
                canvas.height = bgImg.height;

                ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

                // Get the displayed image dimensions for proper scaling
                const displayedImg = document.getElementById('backgroundImage');
                
                // Calculate the scaling factor between the displayed image and actual image
                // The displayed image uses max-width/max-height: 100% and object-fit: contain
                // So we need to find the actual displayed size vs the canvas size
                
                let displayWidth, displayHeight;
                
                // Calculate how the image is actually displayed (considering object-fit: contain)
                const imageAspectRatio = canvas.width / canvas.height;
                const containerMaxWidth = 800; // Approximate container width
                const containerMaxHeight = isMobile() ? window.innerHeight * 0.5 : window.innerHeight * 0.7;
                
                const containerAspectRatio = containerMaxWidth / containerMaxHeight;
                
                if (imageAspectRatio > containerAspectRatio) {
                    // Image is wider, so it will be limited by width
                    displayWidth = Math.min(containerMaxWidth, canvas.width);
                    displayHeight = displayWidth / imageAspectRatio;
                } else {
                    // Image is taller, so it will be limited by height  
                    displayHeight = Math.min(containerMaxHeight, canvas.height);
                    displayWidth = displayHeight * imageAspectRatio;
                }
                
                const scaleX = canvas.width / displayWidth;
                const scaleY = canvas.height / displayHeight;
                
                textSets.forEach(textSet => {
                    ctx.save();
                    
                    // Scale font size to match the image scaling
                    const scaledFontSize = textSet.fontSize * Math.min(scaleX, scaleY);
                    
                    // Set up text properties with proper scaling
                    ctx.font = `${textSet.fontWeight} ${scaledFontSize}px ${textSet.fontFamily}`;
                    ctx.fillStyle = textSet.color;
                    ctx.globalAlpha = textSet.opacity;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';

                    // Calculate position based on the container dimensions and scaling
                    const x = canvas.width * (textSet.left + 50) / 100;
                    const y = canvas.height * (50 - textSet.top) / 100;

                    // Move to position first
                    ctx.translate(x, y);
                    
                    // Apply 3D transforms with proper scaling
                    const tiltXRad = (-textSet.tiltX * Math.PI) / 180;
                    const tiltYRad = (-textSet.tiltY * Math.PI) / 180;

                    // Use a simpler transform that maintains the visual tilt
                    ctx.transform(
                        Math.cos(tiltYRad),          // Horizontal scaling
                        Math.sin(0),          // Vertical skewing
                        -Math.sin(0),         // Horizontal skewing
                        Math.cos(tiltXRad),          // Vertical scaling
                        0,                           // Horizontal translation
                        0                            // Vertical translation
                    );

                    // Apply rotation last
                    ctx.rotate((textSet.rotation * Math.PI) / 180);

                    // Scale letter spacing as well
                    const scaledLetterSpacing = textSet.letterSpacing * Math.min(scaleX, scaleY);

                    if (textSet.letterSpacing === 0) {
                        // Use standard text rendering if no letter spacing
                        ctx.fillText(textSet.text, 0, 0);
                    } else {
                        // Manual letter spacing implementation with scaling
                        const chars = textSet.text.split('');
                        let currentX = 0;
                        // Calculate total width to center properly
                        const totalWidth = chars.reduce((width, char, i) => {
                            const charWidth = ctx.measureText(char).width;
                            return width + charWidth + (i < chars.length - 1 ? scaledLetterSpacing : 0);
                        }, 0);
                        
                        // Start position (centered)
                        currentX = -totalWidth / 2;
                        
                        // Draw each character with scaled spacing
                        chars.forEach((char, i) => {
                            const charWidth = ctx.measureText(char).width;
                            ctx.fillText(char, currentX + charWidth / 2, 0);
                            currentX += charWidth + scaledLetterSpacing;
                        });
                    }
                    ctx.restore();
                });

                if (removedBgImageUrl) {
                    const removedBgImg = new Image();
                    removedBgImg.crossOrigin = "anonymous";
                    removedBgImg.onload = () => {
                        ctx.drawImage(removedBgImg, 0, 0, canvas.width, canvas.height);
                        triggerDownload();
                    };
                    removedBgImg.src = removedBgImageUrl;
                } else {
                    triggerDownload();
                }
            };
            bgImg.src = selectedImage;

            function triggerDownload() {
                const dataUrl = canvas.toDataURL('image/png');
                const link = document.createElement('a');
                link.download = 'text-behind-image.png';
                link.href = dataUrl;
                link.click();
            }
        }
        
        // Handle window resize for mobile orientation changes
        window.addEventListener('resize', function() {
            // Update font size slider range on resize
            if (textSets.length > 0) {
                const currentTextSet = getCurrentTextSet();
                if (currentTextSet) {
                    updateControls(currentTextSet);
                }
            }
        });

        // Prevent keyboard from appearing on mobile when clicking non-input areas
        function setupMobileFocusManagement() {
            const controlsArea = document.querySelector('.controls-area');
            const textInput = document.getElementById('textInput');
            
            if (controlsArea && isMobile()) {
                // Track scroll state to prevent slider interactions during scrolling
                let isScrolling = false;
                let scrollTimeout;
                let startY = 0;
                let scrollStartY = 0;

                // Handle scroll detection
                controlsArea.addEventListener('scroll', function() {
                    isScrolling = true;
                    clearTimeout(scrollTimeout);
                    scrollTimeout = setTimeout(function() {
                        isScrolling = false;
                    }, 100);
                }, { passive: true });

                // Handle touch start for scroll detection
                controlsArea.addEventListener('touchstart', function(e) {
                    startY = e.touches[0].clientY;
                    scrollStartY = controlsArea.scrollTop;
                    
                    const target = e.target;
                    const tagName = target.tagName.toLowerCase();
                    
                    // Allow buttons, inputs, and labels to work normally
                    if (tagName === 'button' || 
                        tagName === 'input' || 
                        tagName === 'label' ||
                        target.classList.contains('add-text-btn') ||
                        target.closest('button')) {
                        return; // Let the event proceed normally
                    }
                    
                    // Only prevent default for non-interactive areas like h3, h4, divs, etc.
                    if (tagName === 'div' || tagName === 'h3' || tagName === 'h4') {
                        // Blur any currently focused input to hide keyboard
                        if (document.activeElement && document.activeElement.tagName === 'INPUT' && document.activeElement.type === 'text') {
                            document.activeElement.blur();
                        }
                    }
                }, { passive: true });

                // Handle touch move to detect if user is scrolling
                controlsArea.addEventListener('touchmove', function(e) {
                    const currentY = e.touches[0].clientY;
                    const deltaY = Math.abs(currentY - startY);
                    
                    // If user moved vertically more than 10px, consider it scrolling
                    if (deltaY > 10) {
                        isScrolling = true;
                    }
                }, { passive: true });


                // Ensure text input can still be focused when tapped directly
                if (textInput) {
                    textInput.addEventListener('touchstart', function(e) {
                        e.stopPropagation(); // Prevent parent touchstart handler
                    }, { passive: true });
                }
            }
        }

        // Setup slider scroll protection for mobile
        function setupSliderScrollProtection() {
            if (!isMobile()) return;
            
            const controlsArea = document.querySelector('.controls-area');
            if (!controlsArea) return;
            
            let isScrolling = false;
            let scrollTimeout;
            let startY = 0;

            // Handle scroll detection
            controlsArea.addEventListener('scroll', function() {
                isScrolling = true;
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(function() {
                    isScrolling = false;
                }, 150);
            }, { passive: true });

            // Handle touch start for scroll detection
            controlsArea.addEventListener('touchstart', function(e) {
                startY = e.touches[0].clientY;
            }, { passive: true });

            // Handle touch move to detect if user is scrolling
            controlsArea.addEventListener('touchmove', function(e) {
                const currentY = e.touches[0].clientY;
                const deltaY = Math.abs(currentY - startY);
                
                // If user moved vertically more than 15px, consider it scrolling
                if (deltaY > 15) {
                    isScrolling = true;
                }
            }, { passive: true });

            // Prevent slider interactions during scroll
            const rangeInputs = controlsArea.querySelectorAll('input[type="range"]');
            rangeInputs.forEach(input => {
                // Remove existing listeners first
                input.removeEventListener('touchstart', input._scrollProtectionHandler);
                input.removeEventListener('touchmove', input._scrollProtectionMoveHandler);
                
                // Add new handlers
                input._scrollProtectionHandler = function(e) {
                    if (isScrolling) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                };
                
                input._scrollProtectionMoveHandler = function(e) {
                    if (isScrolling) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                };
                
                input.addEventListener('touchstart', input._scrollProtectionHandler, { passive: false });
                input.addEventListener('touchmove', input._scrollProtectionMoveHandler, { passive: false });
            });
        }

        // Add visual zone classes to control groups
        function addVisualZoneClasses() {
            if (!isMobile()) return;
            
            const controlGroups = document.querySelectorAll('.control-group');
            controlGroups.forEach(group => {
                // Remove existing zone classes
                group.classList.remove('slider-zone', 'safe-zone');
                
                // Check if this group contains a range input
                const hasSlider = group.querySelector('input[type="range"]');
                if (hasSlider) {
                    group.classList.add('slider-zone');
                } else {
                    group.classList.add('safe-zone');
                }
                
                // Ensure relative positioning for pseudo-elements
                group.style.position = 'relative';
            });
        }

        // Initialize mobile focus management when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            setupMobileFocusManagement();
            setupSliderScrollProtection();
            if (isMobile()) {
                addVisualZoneClasses();
            }
        });

        // Make functions available globally for onclick handlers
        window.addNewTextSet = addNewTextSet;
        window.saveCompositeImage = saveCompositeImage;
        window.updateText = updateText;
        window.updateFontSize = updateFontSize;
        window.updateColor = updateColor;
        window.updatePosition = updatePosition;
        window.updateRotation = updateRotation;
        window.updateTilt = updateTilt;
        window.updateOpacity = updateOpacity;
        window.updateLetterSpacing = updateLetterSpacing;
        window.togglePreviewMode = togglePreviewMode;
    </script>
</body>
</html>